var S=Object.defineProperty,T=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var E=(t,r,e)=>r in t?S(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,m=(t,r)=>{for(var e in r||(r={}))A.call(r,e)&&E(t,e,r[e]);if(d)for(var e of d(r))N.call(r,e)&&E(t,e,r[e]);return t},p=(t,r)=>T(t,v(r));var g=(t,r)=>{var e={};for(var o in t)A.call(t,o)&&r.indexOf(o)<0&&(e[o]=t[o]);if(t!=null&&d)for(var o of d(t))r.indexOf(o)<0&&N.call(t,o)&&(e[o]=t[o]);return e};import{J as R,I as F,d as B,b as y,S as U,P as b,r as C,H,A as G}from"./vendor.b52f82b3.js";const O=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function e(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerpolicy&&(a.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?a.credentials="include":c.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(c){if(c.ep)return;c.ep=!0;const a=e(c);fetch(c.href,a)}};O();const W=t=>t?R.parse(R.stringify(t)):void 0;let V=1;function l(t,r,e){const o=window.ReactNativeWebView;return new Promise((c,a)=>{o.postMessage(JSON.stringify({action:t,data:r,_cb:V,info:e}));const n=function(s){const{status:h}=s.detail;return h==="success"?c(s.detail):a(s.detail)};window.addEventListener(`dapp_${t}`,n,{capture:!0,once:!0})})}const X=(t,r)=>{var e;return!!((t==null?void 0:t.canisterId)&&(t==null?void 0:t.methodName)&&(t==null?void 0:t.arguments)&&((e=r[t.canisterId])==null?void 0:e[t.methodName]))},z=(t,r)=>{if(X(t,r)){const e=t,o=r[e.canisterId][e.methodName];return B(o,e.arguments)}},Y=(t,r,e=!1)=>async(o,c)=>{const a=new Uint8Array(o);return c&&(c.decodedArguments=c.arguments?W(z(c,t)):[]),(await l("requestSign",[a,r,p(m({},c),{arguments:c==null?void 0:c.arguments,preApprove:e})])).result.data},J=t=>{const r=t({IDL:F}),e={};return r._fields.forEach(([o,c])=>e[o]=c.argTypes),e},x=["https://mainnet.dfinity.network","ic0.app"];function M(...t){const r=new Uint8Array(t.reduce((o,c)=>o+c.byteLength,0));let e=0;for(const o of t)r.set(new Uint8Array(o),e),e+=o.byteLength;return r}const L=y.Buffer.from(new TextEncoder().encode(`
ic-request`));class Q extends U{constructor(r,e,o){super();this.signCb=e,this.publicKey=r,this.signCb=e,this.whitelist=o||[]}getPublicKey(){return this.publicKey}async sign(r,e){const o={ingress_expiry:e==null?void 0:e.ingress_expiry.toHash(),sender:(e==null?void 0:e.sender)&&b.from(e.sender).toString(),methodName:e==null?void 0:e.method_name,requestType:e==null?void 0:e.request_type,canisterId:(e==null?void 0:e.canister_id)&&b.from(e.canister_id).toString(),arguments:e==null?void 0:e.arg,manual:!1};return await this.signCb(r,o)}async transformRequest(r){const a=r,{body:e}=a,o=g(a,["body"]),c=await C(e);return p(m({},o),{body:{content:e,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign(M(L,c),e)}})}}function j(t){return y.Buffer.from(t,"hex")}function k(t){return y.Buffer.from(t)}const i=class{static fromRaw(t){return new i(t)}static fromDer(t){return new i(this.derDecode(t))}static from(t){return this.fromDer(t.toDer())}static derEncode(t){if(t.byteLength!==i.RAW_KEY_LENGTH){const e=t.byteLength;throw new TypeError(`secp256k1 public key must be ${i.RAW_KEY_LENGTH} bytes long (is ${e})`)}const r=Uint8Array.from([...i.DER_PREFIX,...new Uint8Array(t)]);return k(r)}static derDecode(t){const r=i.DER_PREFIX.length+i.RAW_KEY_LENGTH;if(t.byteLength!==r){const o=t.byteLength;throw new TypeError(`secp256k1 DER-encoded public key must be ${r} bytes long (is ${o})`)}const e=k(t.subarray(i.DER_PREFIX.length));if(!this.derEncode(e).equals(t))throw new TypeError(`secp256k1 DER-encoded public key is invalid. A valid secp256k1 DER-encoded public key must have the following prefix: ${i.DER_PREFIX}`);return e}constructor(t){this.rawKey=t,this.derKey=i.derEncode(t)}toDer(){return this.derKey}toRaw(){return this.rawKey}};let f=i;f.RAW_KEY_LENGTH=65;f.DER_PREFIX=Uint8Array.from([48,86,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10,3,66,0]);const Z=x[0],K={whitelist:[],host:Z},D=async(t,{whitelist:r=K.whitelist,host:e=K.host},o,c=!1)=>{const a=f.fromRaw(j(t)),n=new Q(a,Y(o,{host:e,name:"host"},c),r),s=new H({identity:n,host:e});return x.includes(e)||await s.fetchRootKey(),s},I=async(t,r,e)=>G.createActor(e,{agent:t,canisterId:r});window.Buffer=window.Buffer||y.Buffer;const P="icpbox:publicKey";let w,_=localStorage.getItem(P);const q=[];var u={get webview(){return window.ReactNativeWebView},get publicKey(){return _},setPublickKey(t){_=t,localStorage.setItem(P,t)},check:function(){return"ReactNativeWebView"in window&&navigator.userAgent.match("ICPBox/")},isConnected:async function(){return(await l("isConnected",{})).result},authorize:async function(t){t.host=location.host,t.icon=t.icon||location.origin+"/favicon.ico";const r=await l("authorize",t);return this.setPublickKey(r.publicKey),r},pay:function(t){return t.host=t.host||location.host,t.icon=t.icon||location.origin+"/favicon.ico",t.fee=t.fee||"10000",l("pay",t)},async createActor({canisterId:t,interfaceFactory:r}){return q[t]=J(r),w||(w=await D(_,{whitelist:[t]},q)),I(w,t,r)},disConnect(){return l("disConnect",{host:location.host})}};const tt=({IDL:t})=>{const r=t.Variant({LenEq:t.Nat8,LenGte:t.Nat8}),e=t.Record({code:t.Nat32,message:t.Text}),o=t.Variant({Ok:t.Nat32,Err:e});return t.Service({get_quota:t.Func([t.Principal,r],[o],["query"])})};var et=async()=>{const t="onof3-pyaaa-aaaal-qac6a-cai",e=await(await u.createActor({canisterId:t,interfaceFactory:tt})).get_quota(b.fromText("nmfh2-f7y7y-gkelu-x2z7h-rjynj-wcn4n-u47my-hxi7f-irne2-nungu-4ae"),{LenGte:7});console.log("quota: ",e)};window.global=window;(async function(){const t=async function(){const c=await u.isConnected();document.getElementById("status-connect").innerText=c?"connectd":"not connected"},r=async function(){try{const c=await u.authorize({canisters:["quctq-dsfdf-asdfs-dsfds-asd","quctq-dsfdf-asdfs-dsfds-a2d"]});console.log("auth ok: ",c,u.publicKey)}catch(c){console.log("error: ",c)}},e=async function(){const c="qoctq-giaaa-aaaaa-aaaea-cai",a=({IDL:n})=>{const s=n.Nat64,h=n.Record({latest_transaction_block_height:s,seconds_since_last_ledger_sync:n.Nat64,sub_accounts_count:n.Nat64,hardware_wallet_accounts_count:n.Nat64,accounts_count:n.Nat64,earliest_transaction_block_height:s,transactions_count:n.Nat64,block_height_synced_up_to:n.Opt(n.Nat64),latest_transaction_timestamp_nanos:n.Nat64,earliest_transaction_timestamp_nanos:n.Nat64});return n.Service({get_stats:n.Func([],[h],["query"])})};try{const s=await(await u.createActor({canisterId:c,interfaceFactory:a})).get_stats();console.log("NNS stats",s)}catch(n){console.log("error: ",n)}await et()},o=async function(){try{const c=await u.pay({amount:"0.01",to:"icpnftfi.icp",memo:"392432"});console.log("pay: ",c)}catch(c){console.log(c)}};$("document").ready(function(){$("#check").on("click",t),$("#auth").on("click",r),$("#buy").on("click",o),$("#call-canister").on("click",e),$("#disconnect").on("click",async function(){await u.disConnect(),console.log("disconnected")})})})();
