var q=Object.defineProperty,S=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var E=(e,r,t)=>r in e?q(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,p=(e,r)=>{for(var t in r||(r={}))N.call(r,t)&&E(e,t,r[t]);if(d)for(var t of d(r))A.call(r,t)&&E(e,t,r[t]);return e},_=(e,r)=>S(e,v(r));var R=(e,r)=>{var t={};for(var a in e)N.call(e,a)&&r.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&d)for(var a of d(e))r.indexOf(a)<0&&A.call(e,a)&&(t[a]=e[a]);return t};import{J as g,I as F,d as B,b as y,S as U,P as b,h as C,r as G,H,A as O}from"./vendor.90eb068f.js";const V=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);new MutationObserver(c=>{for(const n of c)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(c){const n={};return c.integrity&&(n.integrity=c.integrity),c.referrerpolicy&&(n.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?n.credentials="include":c.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(c){if(c.ep)return;c.ep=!0;const n=t(c);fetch(c.href,n)}};V();const W=e=>e?g.parse(g.stringify(e)):void 0;let X=1;function l(e,r,t){const a=window.ReactNativeWebView;return new Promise((c,n)=>{a.postMessage(JSON.stringify({action:e,data:r,_cb:X,info:t}));const o=function(s){const{status:h}=s.detail;return h==="success"?c(s.detail):n(s.detail)};window.addEventListener(`dapp_${e}`,o,{capture:!0,once:!0})})}const z=(e,r)=>{var t;return!!((e==null?void 0:e.canisterId)&&(e==null?void 0:e.methodName)&&(e==null?void 0:e.arguments)&&((t=r[e.canisterId])==null?void 0:t[e.methodName]))},Y=(e,r)=>{if(z(e,r)){const t=e,a=r[t.canisterId][t.methodName];return B(a,t.arguments)}},J=(e,r,t=!1)=>async(a,c)=>{const n=new Uint8Array(a);return c&&(c.decodedArguments=c.arguments?W(Y(c,e)):[]),(await l("requestSign",[n,r,_(p({},c),{arguments:c==null?void 0:c.arguments,preApprove:t})])).result.data},M=e=>{const r=e({IDL:F}),t={};return r._fields.forEach(([a,c])=>t[a]=c.argTypes),t},P=["https://mainnet.dfinity.network","ic0.app"];function Q(...e){const r=new Uint8Array(e.reduce((a,c)=>a+c.byteLength,0));let t=0;for(const a of e)r.set(new Uint8Array(a),t),t+=a.byteLength;return r}const j=y.Buffer.from(new TextEncoder().encode(`
ic-request`)),Z=new TextDecoder;class L extends U{constructor(r,t,a){super();this.signCb=t,this.publicKey=r,this.signCb=t,this.whitelist=a||[]}getPublicKey(){return this.publicKey}async sign(r,t){const a={ingress_expiry:t==null?void 0:t.ingress_expiry.toHash(),sender:(t==null?void 0:t.sender)&&b.from(t.sender).toString(),methodName:t==null?void 0:t.method_name,requestType:t==null?void 0:t.request_type,canisterId:(t==null?void 0:t.canister_id)&&b.from(t.canister_id).toString(),arguments:t==null?void 0:t.arg,manual:!1,paths:t!=null&&t.paths?Z.decode(C(t.paths)):void 0};return await this.signCb(r,a)}async transformRequest(r){const n=r,{body:t}=n,a=R(n,["body"]),c=await G(t);return _(p({},a),{body:{content:t,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign(Q(j,c),t)}})}}function D(e){return y.Buffer.from(e,"hex")}function k(e){return y.Buffer.from(e)}const i=class{static fromRaw(e){return new i(e)}static fromDer(e){return new i(this.derDecode(e))}static from(e){return this.fromDer(e.toDer())}static derEncode(e){if(e.byteLength!==i.RAW_KEY_LENGTH){const t=e.byteLength;throw new TypeError(`secp256k1 public key must be ${i.RAW_KEY_LENGTH} bytes long (is ${t})`)}const r=Uint8Array.from([...i.DER_PREFIX,...new Uint8Array(e)]);return k(r)}static derDecode(e){const r=i.DER_PREFIX.length+i.RAW_KEY_LENGTH;if(e.byteLength!==r){const a=e.byteLength;throw new TypeError(`secp256k1 DER-encoded public key must be ${r} bytes long (is ${a})`)}const t=k(e.subarray(i.DER_PREFIX.length));if(!this.derEncode(t).equals(e))throw new TypeError(`secp256k1 DER-encoded public key is invalid. A valid secp256k1 DER-encoded public key must have the following prefix: ${i.DER_PREFIX}`);return t}constructor(e){this.rawKey=e,this.derKey=i.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}};let f=i;f.RAW_KEY_LENGTH=65;f.DER_PREFIX=Uint8Array.from([48,86,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10,3,66,0]);const I=P[0],T={whitelist:[],host:I},ee=async(e,{whitelist:r=T.whitelist,host:t=T.host},a,c=!1)=>{const n=f.fromRaw(D(e)),o=new L(n,J(a,{host:t,origin:location.origin,name:document.title},c),r),s=new H({identity:o,host:t});return P.includes(t)||await s.fetchRootKey(),s},te=async(e,r,t)=>O.createActor(t,{agent:e,canisterId:r});window.Buffer=window.Buffer||y.Buffer;const K="icpbox:publicKey";let m,w=localStorage.getItem(K);const x=[];var u={get webview(){return window.ReactNativeWebView},get publicKey(){return w},setPublickKey(e){w=e,localStorage.setItem(K,e)},check:function(){return"ReactNativeWebView"in window&&navigator.userAgent.match("ICPBox/")},isConnected:async function(){return(await l("isConnected",{})).result},authorize:async function(e){e.host=location.host,e.icon=e.icon||location.origin+"/favicon.ico";const r=await l("authorize",e);return this.setPublickKey(r.publicKey),r},pay:function(e){return e.host=e.host||location.host,e.icon=e.icon||location.origin+"/favicon.ico",e.fee=e.fee||"10000",l("pay",e)},async createActor({canisterId:e,interfaceFactory:r}){return x[e]=M(r),m||(m=await ee(w,{whitelist:[e]},x)),te(m,e,r)},disConnect(){return l("disConnect",{host:location.host})}};const re=({IDL:e})=>{const r=e.Variant({LenEq:e.Nat8,LenGte:e.Nat8}),t=e.Record({code:e.Nat32,message:e.Text}),a=e.Record({len:e.Nat8,price_in_icp_e8s:e.Nat64,price_in_xdr_permyriad:e.Nat64}),c=e.Record({icp_xdr_conversion_rate:e.Nat64,items:e.Vec(a)}),n=e.Variant({Ok:e.Nat32,Err:t}),o=e.Variant({Ok:c,Err:t});return e.Service({get_price_table:e.Func([],[o],[]),get_quota:e.Func([e.Principal,r],[n],["query"])})};var ce=async()=>{const e="onof3-pyaaa-aaaal-qac6a-cai",r=await u.createActor({canisterId:e,interfaceFactory:re}),t=await r.get_quota(b.fromText("nmfh2-f7y7y-gkelu-x2z7h-rjynj-wcn4n-u47my-hxi7f-irne2-nungu-4ae"),{LenGte:7}),a=await r.get_price_table();console.log("quota: ",t,a)};window.global=window;(async function(){const e=async function(){const c=await u.isConnected();document.getElementById("status-connect").innerText=c?"connectd":"not connected"},r=async function(){try{const c=await u.authorize({canisters:["quctq-dsfdf-asdfs-dsfds-asd","quctq-dsfdf-asdfs-dsfds-a2d"]});console.log("auth ok: ",c,u.publicKey)}catch(c){console.log("error: ",c)}},t=async function(){const c="qoctq-giaaa-aaaaa-aaaea-cai",n=({IDL:o})=>{const s=o.Nat64,h=o.Record({latest_transaction_block_height:s,seconds_since_last_ledger_sync:o.Nat64,sub_accounts_count:o.Nat64,hardware_wallet_accounts_count:o.Nat64,accounts_count:o.Nat64,earliest_transaction_block_height:s,transactions_count:o.Nat64,block_height_synced_up_to:o.Opt(o.Nat64),latest_transaction_timestamp_nanos:o.Nat64,earliest_transaction_timestamp_nanos:o.Nat64});return o.Service({get_stats:o.Func([],[h],["query"])})};try{const s=await(await u.createActor({canisterId:c,interfaceFactory:n})).get_stats();console.log("NNS stats",s)}catch(o){console.log("error: ",o)}await ce()},a=async function(){try{const c=await u.pay({amount:"0.01",to:"icpnftfi.icp",memo:"392432"});console.log("pay: ",c)}catch(c){console.log(c)}};$("document").ready(function(){$("#check").on("click",e),$("#auth").on("click",r),$("#buy").on("click",a),$("#call-canister").on("click",t),$("#disconnect").on("click",async function(){await u.disConnect(),console.log("disconnected")})})})();
