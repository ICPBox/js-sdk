var S=Object.defineProperty,x=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var l=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var E=(t,r,e)=>r in t?S(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,m=(t,r)=>{for(var e in r||(r={}))A.call(r,e)&&E(t,e,r[e]);if(l)for(var e of l(r))N.call(r,e)&&E(t,e,r[e]);return t},w=(t,r)=>x(t,P(r));var g=(t,r)=>{var e={};for(var n in t)A.call(t,n)&&r.indexOf(n)<0&&(e[n]=t[n]);if(t!=null&&l)for(var n of l(t))r.indexOf(n)<0&&N.call(t,n)&&(e[n]=t[n]);return e};import{I as v,d as F,b as y,S as U,P as f,r as C,H as B,A as G}from"./vendor.75aab190.js";const H=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerpolicy&&(a.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?a.credentials="include":c.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(c){if(c.ep)return;c.ep=!0;const a=e(c);fetch(c.href,a)}};H();let O=1;function d(t,r,e){const n=window.ReactNativeWebView;return new Promise((c,a)=>{n.postMessage(JSON.stringify({action:t,data:r,_cb:O,info:e}));const o=function(s){const{status:h}=s.detail;return h==="success"?c(s.detail):a(s.detail)};window.addEventListener(`dapp_${t}`,o,{capture:!0,once:!0})})}const W=(t,r)=>{var e;return!!((t==null?void 0:t.canisterId)&&(t==null?void 0:t.methodName)&&(t==null?void 0:t.arguments)&&((e=r[t.canisterId])==null?void 0:e[t.methodName]))},V=(t,r)=>{if(W(t,r)){const e=t,n=r[e.canisterId][e.methodName];return F(n,e.arguments)}},X=new TextDecoder,z=(t,r,e=!1)=>async(n,c)=>{const a=new Uint8Array(n);return c&&(c.decodedArguments=c.arguments?V(c,t):[]),(await d("requestSign",[a,r,w(m({},c),{arguments:X.decode(c==null?void 0:c.arguments),preApprove:e})])).result.data},Y=t=>{const r=t({IDL:v}),e={};return r._fields.forEach(([n,c])=>e[n]=c.argTypes),e},q=["https://mainnet.dfinity.network","ic0.app"];function M(...t){const r=new Uint8Array(t.reduce((n,c)=>n+c.byteLength,0));let e=0;for(const n of t)r.set(new Uint8Array(n),e),e+=n.byteLength;return r}const j=y.Buffer.from(new TextEncoder().encode(`
ic-request`));class L extends U{constructor(r,e,n){super();this.signCb=e,this.publicKey=r,this.signCb=e,this.whitelist=n||[]}getPublicKey(){return this.publicKey}async sign(r,e){return await this.signCb(r,{sender:(e==null?void 0:e.sender)&&f.from(e.sender).toString(),methodName:e==null?void 0:e.method_name,requestType:e==null?void 0:e.request_type,canisterId:(e==null?void 0:e.canister_id)&&f.from(e.canister_id).toString(),arguments:e==null?void 0:e.arg,manual:!1})}async transformRequest(r){const a=r,{body:e}=a,n=g(a,["body"]),c=await C(e);return w(m({},n),{body:{content:e,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign(M(j,c),e)}})}}function Q(t){return y.Buffer.from(t,"hex")}function R(t){return y.Buffer.from(t)}const i=class{static fromRaw(t){return new i(t)}static fromDer(t){return new i(this.derDecode(t))}static from(t){return this.fromDer(t.toDer())}static derEncode(t){if(t.byteLength!==i.RAW_KEY_LENGTH){const e=t.byteLength;throw new TypeError(`secp256k1 public key must be ${i.RAW_KEY_LENGTH} bytes long (is ${e})`)}const r=Uint8Array.from([...i.DER_PREFIX,...new Uint8Array(t)]);return R(r)}static derDecode(t){const r=i.DER_PREFIX.length+i.RAW_KEY_LENGTH;if(t.byteLength!==r){const n=t.byteLength;throw new TypeError(`secp256k1 DER-encoded public key must be ${r} bytes long (is ${n})`)}const e=R(t.subarray(i.DER_PREFIX.length));if(!this.derEncode(e).equals(t))throw new TypeError(`secp256k1 DER-encoded public key is invalid. A valid secp256k1 DER-encoded public key must have the following prefix: ${i.DER_PREFIX}`);return e}constructor(t){this.rawKey=t,this.derKey=i.derEncode(t)}toDer(){return this.derKey}toRaw(){return this.rawKey}};let b=i;b.RAW_KEY_LENGTH=65;b.DER_PREFIX=Uint8Array.from([48,86,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10,3,66,0]);const J=q[0],k={whitelist:[],host:J},Z=async(t,{whitelist:r=k.whitelist,host:e=k.host},n,c=!1)=>{const a=b.fromRaw(Q(t)),o=new L(a,z(n,{host:e,name:"host"},c),r),s=new B({identity:o,host:e});return q.includes(e)||await s.fetchRootKey(),s},D=async(t,r,e)=>G.createActor(e,{agent:t,canisterId:r});window.Buffer=window.Buffer||y.Buffer;const T="icpbox:publicKey";let p,_=localStorage.getItem(T);const K=[];var u={get webview(){return window.ReactNativeWebView},get publicKey(){return _},setPublickKey(t){_=t,localStorage.setItem(T,t)},check:function(){return"ReactNativeWebView"in window&&navigator.userAgent.match("ICPBox/")},isConnected:async function(){return(await d("isConnected",{})).result},authorize:async function(t){t.host=location.host,t.icon=t.icon||location.origin+"/favicon.ico";const r=await d("authorize",t);return this.setPublickKey(r.publicKey),r},pay:function(t){return t.host=t.host||location.host,t.icon=t.icon||location.origin+"/favicon.ico",t.fee=t.fee||"10000",d("pay",t)},async createActor({canisterId:t,interfaceFactory:r}){return K[t]=Y(r),p||(p=await Z(_,{whitelist:[t]},K)),D(p,t,r)},disConnect(){return d("disConnect",{host:location.host})}};const I=({IDL:t})=>{const r=t.Variant({LenEq:t.Nat8,LenGte:t.Nat8}),e=t.Record({code:t.Nat32,message:t.Text}),n=t.Variant({Ok:t.Nat32,Err:e});return t.Service({get_quota:t.Func([t.Principal,r],[n],["query"])})};var tt=async()=>{const t="onof3-pyaaa-aaaal-qac6a-cai",e=await(await u.createActor({canisterId:t,interfaceFactory:I})).get_quota(f.fromText("nmfh2-f7y7y-gkelu-x2z7h-rjynj-wcn4n-u47my-hxi7f-irne2-nungu-4ae"),{LenGte:7});console.log("quota: ",e)};window.global=window;(async function(){const t=async function(){const c=await u.isConnected();document.getElementById("status-connect").innerText=c?"connectd":"not connected"},r=async function(){try{const c=await u.authorize({canisters:["quctq-dsfdf-asdfs-dsfds-asd","quctq-dsfdf-asdfs-dsfds-a2d"]});console.log("auth ok: ",c,u.publicKey)}catch(c){console.log("error: ",c)}},e=async function(){const c="qoctq-giaaa-aaaaa-aaaea-cai",a=({IDL:o})=>{const s=o.Nat64,h=o.Record({latest_transaction_block_height:s,seconds_since_last_ledger_sync:o.Nat64,sub_accounts_count:o.Nat64,hardware_wallet_accounts_count:o.Nat64,accounts_count:o.Nat64,earliest_transaction_block_height:s,transactions_count:o.Nat64,block_height_synced_up_to:o.Opt(o.Nat64),latest_transaction_timestamp_nanos:o.Nat64,earliest_transaction_timestamp_nanos:o.Nat64});return o.Service({get_stats:o.Func([],[h],["query"])})};try{const s=await(await u.createActor({canisterId:c,interfaceFactory:a})).get_stats();console.log("NNS stats",s)}catch(o){console.log("error: ",o)}await tt()},n=async function(){try{const c=await u.pay({amount:"0.01",to:"icpnftfi.icp",memo:"392432"})}catch(c){console.log(c)}};$("document").ready(function(){$("#check").on("click",t),$("#auth").on("click",r),$("#buy").on("click",n),$("#call-canister").on("click",e),$("#disconnect").on("click",async function(){await u.disConnect(),console.log("disconnected")})})})();
